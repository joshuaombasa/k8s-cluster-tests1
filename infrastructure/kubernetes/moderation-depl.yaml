apiVersion: apps/v1
kind: Deployment
metadata:
  name: moderation-depl
  labels:
    app: moderation
spec:
  replicas: 2   # run more than 1 replica for resilience
  selector:
    matchLabels:
      app: moderation
  template:
    metadata:
      labels:
        app: moderation
    spec:
      containers:
        - name: moderation
          image: joshuaombasa/cluester2-test-moderation:latest
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 3033
          resources:              # resource requests/limits
            requests:
              cpu: "100m"
              memory: "128Mi"
            limits:
              cpu: "250m"
              memory: "256Mi"
          livenessProbe:          # health checks
            httpGet:
              path: /healthz
              port: 3033
            initialDelaySeconds: 5
            periodSeconds: 10
          readinessProbe:
            httpGet:
              path: /ready
              port: 3033
            initialDelaySeconds: 5
            periodSeconds: 10

---

apiVersion: v1
kind: Service
metadata:
  name: moderation-svc
  labels:
    app: moderation
spec:
  type: ClusterIP   # could be LoadBalancer or NodePort if external access is needed
  selector:
    app: moderation
  ports:
    - name: http
      protocol: TCP
      port: 3033
      targetPort: 3033
